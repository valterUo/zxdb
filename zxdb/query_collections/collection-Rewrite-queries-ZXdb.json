{
  "version": 1,
  "type": "collection",
  "title": "Rewrite queries - ZXdb",
  "items": [
    {
      "title": "Hadamard edge cancellation",
      "description": "",
      "query": {
        "code": {
          "value": "// Find all marked patterns\r\nMATCH (s)\r\nWHERE s.pattern_id IS NOT NULL\r\n\r\n// Reconstruct the full path for each pattern\r\nWITH DISTINCT s.pattern_id AS pattern_id\r\nMATCH path = (start)-[:Wire*2..6]-(end)\r\nWHERE ALL(edge IN relationships(path) WHERE edge.pattern_id = pattern_id)\r\nAND start.pattern_id IS NULL AND end.pattern_id IS NULL AND id(start) < id(end)\r\n\r\nWITH start, end, pattern_id,\r\n      [node IN nodes(path)[1..-1] WHERE node.pattern_id = pattern_id] as nodes_to_delete\r\n\r\n// Create direct connection\r\nWITH DISTINCT start, end, nodes_to_delete, pattern_id\r\nCREATE (start)-[newWire:Wire {t: 1}]->(end)\r\n\r\n// Delete the nodes with the corresponding Hadamard edges\r\nWITH nodes_to_delete, pattern_id\r\nUNWIND nodes_to_delete AS node\r\nDETACH DELETE node\r\n\r\n// Return something to ensure changes were made\r\nWITH pattern_id\r\nRETURN COUNT(DISTINCT pattern_id) as patterns_processed"
        },
        "params": {}
      },
      "style": {
        "code": {
          "value": "// A palette of colors used to color distinct node labels\nDefine(COLOR_PALETTE, AsArray(\n  #DD2222, #FB6E00, #FFC500, #720096,\n  #5E4FA2, #3288BD, #66C2A5, #ABDDA4,\n  #E6F598, #FEE08B, #D53E4F, #9E0142\n))\nDefine(COLOR_PALETTE_ITER, AsIterator(COLOR_PALETTE))\n\n// If there are no palette colors to use, use random colors instead\nDefine(RandomColor, Function(RGB(RandomInt(255), RandomInt(255), RandomInt(255))))\nDefine(GetNextColor, Function(\n  Coalesce(Next(COLOR_PALETTE_ITER), RandomColor())\n))\n\n// Cache map to keep a selected color for each node label\nDefine(ColorByLabel, AsMap())\nDefine(GetColorByLabel, Function(labels, Coalesce(\n  Get(ColorByLabel, labels),\n  Set(ColorByLabel, labels, GetNextColor())\n)))\nDefine(JoinLabels, Function(labels, Join(Sort(labels), \":\")))\n\n// Baseline node style that will be applied to every single node\n@NodeStyle {\n  Define(COLOR, GetColorByLabel(JoinLabels(Labels(node))))\n\n  size: 6\n  color: COLOR\n  color-hover: Lighter(COLOR)\n  color-selected: Darker(COLOR)\n  border-width: 0.6\n  border-color: #1D1D1D\n  font-size: 3\n  font-color: #1D1D1D\n}\n\n// Overwrite node text with the node label if defined\n@NodeStyle Greater(Size(Labels(node)), 0) {\n  label: Format(\":{}\", Join(Labels(node), \" :\"))\n}\n\n// Overwrite node text with the property \"name\" if defined\n@NodeStyle HasProperty(node, \"name\") {\n  label: AsText(Property(node, \"name\"))\n}\n\n// Feel free to uncomment the lines below to set up a custom style for the specific node label\n// @NodeStyle HasLabel(node, \"MyCustomLabel\") {\n//   color: black\n// }\n\n// Feel free to uncomment the lines below to set up a custom style for the specific node property\n// @NodeStyle HasProperty(node, \"my_property_name\") {\n//   color: black\n//   label: AsText(Property(node, \"my_property_name\"))\n// }\n\nDefine(LATITUDE_FIELD, \"lat\")\nDefine(LONGITUDE_FIELD, \"lng\")\n\n// In the case of numeric latitude and longitude properties, set them up for a switch to a map view\n@NodeStyle And(IsNumber(Property(node, LATITUDE_FIELD)), IsNumber(Property(node, LONGITUDE_FIELD))) {\n  latitude: Property(node, LATITUDE_FIELD)\n  longitude: Property(node, LONGITUDE_FIELD)\n}\n\n// Baseline edge style that will be applied to every single edge\n@EdgeStyle {\n  color: #999999\n  color-hover: #1D1D1D\n  color-selected: #1D1D1D\n  width: 0.3\n  width-hover: 0.9\n  width-selected: 0.9\n  font-size: 3\n  font-color: #1D1D1D\n}\n\n// Show edge text only if there is a small number of edges in the view\n@EdgeStyle Less(EdgeCount(graph), 30) {\n  label: Type(edge)\n}\n\n// In case of a map view, set the default tile layer\n@ViewStyle.Map {\n  tile-layer: \"light\"\n}\n\n// Canvas background color\n@ViewStyle {\n  background-color: #FFFFFF00\n}\n"
        },
        "title": "System Style"
      }
    }
  ]
}